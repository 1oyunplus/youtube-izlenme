<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Ekle - YouTube Coin System</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- Header -->
    <header class="app-header">
        <div class="header-content">
            <h1>ğŸ¥ YT Coin</h1>
            <div class="user-info">
                <div class="coin-display">
                    <span class="coin-icon">ğŸ’°</span>
                    <span id="coinCount">0</span>
                </div>
                <span class="username" id="headerUsername">User</span>
            </div>
        </div>
    </header>

    <!-- Upload Form -->
    <main class="upload-container">
        <div class="upload-box">
            <h2>ğŸ“¤ Video Ekle</h2>
            <p class="upload-info">Video eklemek iÃ§in <strong>100 Coin</strong> gerekli</p>
            
            <div class="upload-form">
                <label for="videoUrl">YouTube Video Linki:</label>
                <input 
                    type="text" 
                    id="videoUrl" 
                    placeholder="https://www.youtube.com/watch?v=..."
                    class="input-field">
                
                <p class="help-text">
                    Ã–rnek: https://www.youtube.com/watch?v=dQw4w9WgXcQ<br>
                    veya: https://youtu.be/dQw4w9WgXcQ
                </p>

                <button id="uploadBtn" class="btn-primary">Video Ekle (100 Coin)</button>
            </div>

            <!-- KullanÄ±cÄ±nÄ±n yÃ¼klediÄŸi videolar -->
            <div class="my-videos">
                <h3>YÃ¼klediÄŸim Videolar</h3>
                <div id="myVideoList" class="video-list">
                    <p class="empty-state">HenÃ¼z video eklemedin</p>
                </div>
            </div>
        </div>
    </main>

    <!-- Alt Navigasyon -->
    <nav class="bottom-nav">
        <a href="index.html" class="nav-item">
            <span class="nav-icon">ğŸ </span>
            <span>Ana Sayfa</span>
        </a>
        <a href="upload.html" class="nav-item active">
            <span class="nav-icon">ğŸ“¤</span>
            <span>Video Ekle</span>
        </a>
        <a href="store.html" class="nav-item">
            <span class="nav-icon">ğŸ›’</span>
            <span>MaÄŸaza</span>
        </a>
        <a href="#" id="logoutBtn" class="nav-item">
            <span class="nav-icon">ğŸšª</span>
            <span>Ã‡Ä±kÄ±ÅŸ</span>
        </a>
    </nav>

    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/coin.js"></script>
    <script>
        // Upload sayfasÄ± iÃ§in Ã¶zel script
        const videoUrlInput = document.getElementById('videoUrl');
        const uploadBtn = document.getElementById('uploadBtn');
        const myVideoList = document.getElementById('myVideoList');

        // Sayfa yÃ¼klendiÄŸinde kullanÄ±cÄ±nÄ±n videolarÄ±nÄ± gÃ¶ster
        function loadMyVideos() {
            const currentUser = DB.getCurrentUser();
            if (!currentUser) return;

            const userVideos = DB.getUserVideos(currentUser.userId);
            
            if (userVideos.length === 0) {
                myVideoList.innerHTML = '<p class="empty-state">HenÃ¼z video eklemedin</p>';
                return;
            }

            myVideoList.innerHTML = userVideos.map(video => `
                <div class="video-item">
                    <span class="video-id">${video.videoId}</span>
                    <span class="video-date">${new Date(video.uploadedAt).toLocaleDateString('tr-TR')}</span>
                </div>
            `).join('');
        }

        // YouTube ID Ã§Ä±karma fonksiyonu
        function extractYouTubeID(url) {
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/)([a-zA-Z0-9_-]{11})/,
                /youtube\.com\/embed\/([a-zA-Z0-9_-]{11})/
            ];

            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) return match[1];
            }
            return null;
        }

        // Video yÃ¼kleme
        uploadBtn.addEventListener('click', () => {
            const url = videoUrlInput.value.trim();
            
            if (!url) {
                alert('âŒ LÃ¼tfen bir YouTube linki girin!');
                return;
            }

            const videoId = extractYouTubeID(url);
            if (!videoId) {
                alert('âŒ GeÃ§ersiz YouTube linki! LÃ¼tfen geÃ§erli bir link girin.');
                return;
            }

            const currentUser = DB.getCurrentUser();
            if (!currentUser) {
                alert('âŒ GiriÅŸ yapmalÄ±sÄ±nÄ±z!');
                window.location.href = 'login.html';
                return;
            }

            // Coin kontrolÃ¼
            if (currentUser.coin < 100) {
                const needed = 100 - currentUser.coin;
                alert(`âŒ Yetersiz coin! ${needed} coin daha gerekli.\n\nMaÄŸazadan coin satÄ±n alabilirsiniz.`);
                return;
            }

            // Video ekle ve coin dÃ¼ÅŸ
            if (DB.addVideo(videoId, currentUser.userId)) {
                DB.updateCoins(currentUser.userId, -100);
                alert('âœ… Video baÅŸarÄ±yla eklendi! 100 coin harcandÄ±.');
                videoUrlInput.value = '';
                updateCoinDisplay();
                loadMyVideos();
            } else {
                alert('âŒ Bu video zaten sistemde mevcut!');
            }
        });

        // Sayfa yÃ¼klendiÄŸinde
        loadMyVideos();
    </script>
</body>
</html>